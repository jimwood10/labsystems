# update /etc/hosts with new ip address

oldIP=$(grep $(hostname) /etc/hosts | grep -v ces | awk '{print $1}')
newIP=$(hostname -I | awk '{print $1}')
sed -i "s/$oldIP/$newIP/" /etc/hosts

echo "$(hostname -s) --daemon-interface=$(hostname) --admin-interface=$(hostname)" > nodeIpUpdateFile

mmshutdown && sleep 10
mmchnode --spec-file nodeIpUpdateFile --force
mmstartup 
while true; do
   mmgetstate  | grep -i active
    rc=$?

    if [ $rc -eq 0 ]; then
        echo "mmfsd active"
        sleep 5
        break
    else
        echo "mmfsd not ready"
        sleep 5  # Optional: wait before retrying
    fi
done
systemctl start gpfsgui
mmmount all -a && mmgetstate && mmlsmount all
